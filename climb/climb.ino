#include <Wire.h>
#include <Adafruit_PWMServoDriver.h>

#define PI 3.1415926535897932384626
#define ANGLE_DEFAULT 90

int pinArmL = 1;
int pinArmR = 0;

int magnetR = 3;
int magnetL = 4;
int magnetC = 5;

Adafruit_PWMServoDriver pwm = Adafruit_PWMServoDriver();

void setup()
{
  // Initialize servo motor
  pwm.begin();
  pwm.setPWMFreq(50);
  pwm.setPWM(pinArmL, 0, map(ANGLE_DEFAULT, 0, 180, 150, 600));
  pwm.setPWM(pinArmR, 0, map(ANGLE_DEFAULT, 0, 180, 150, 600));

  // Initialize magnet
  pinMode(magnetR, OUTPUT);
  pinMode(magnetL, OUTPUT);
  pinMode(magnetC, OUTPUT);
  digitalWrite(magnetL, HIGH);
  digitalWrite(magnetR, HIGH);
  delay(1000);

  // Servo test code
  //  delay(10000);
  //  for (float theta = 0;; theta += 0.01) {
  //    pwm.setPWM(pinArmR, 0, ANGLE_DEFAULT + sin(theta) * 70);
  //    delay(10);
  //  }
}

void setServo(double l, double r)
{
  double angleLeft = ANGLE_DEFAULT + 150 - l * 180 / PI;
  double angleRight = ANGLE_DEFAULT + r * 180 / PI - 150;

  pwm.setPWM(pinArmL, 0, map(angleLeft, 0, 180, 150, 600));
  pwm.setPWM(pinArmR, 0, map(angleRight, 0, 180, 150, 600));
  delay(10);
}

void loop()
{
  setServo(2.6179938779914944, 2.6179938779914944);
  setServo(2.6080887603469263, 2.627993877991494);
  setServo(2.5983699241894533, 2.637993877991494);
  setServo(2.5888324069118784, 2.6479938779914938);
  setServo(2.5794715719881314, 2.6579938779914936);
  setServo(2.570283082169766, 2.6679938779914933);
  setServo(2.5612628755049816, 2.677993877991493);
  setServo(2.552407143826484, 2.687993877991493);
  setServo(2.5437123134058095, 2.6979938779914927);
  setServo(2.535175027514824, 2.7079938779914925);
  setServo(2.526792130671116, 2.7179938779914923);
  setServo(2.518560654374376, 2.727993877991492);
  setServo(2.510477804166715, 2.737993877991492);
  setServo(2.5025409478715375, 2.7479938779914916);
  setServo(2.4947476048844157, 2.7579938779914914);
  setServo(2.48709543640514, 2.767993877991491);
  setServo(2.4795822365139273, 2.777993877991491);
  setServo(2.4722059240064556, 2.787993877991491);
  setServo(2.464964534912592, 2.7979938779914906);
  setServo(2.4578562156323684, 2.8079938779914904);
  setServo(2.4508792166305833, 2.81799387799149);
  setServo(2.4440318866377906, 2.82799387799149);
  setServo(2.43731266731149, 2.8379938779914897);
  setServo(2.430720088316199, 2.8479938779914895);
  setServo(2.424252762785689, 2.8579938779914893);
  setServo(2.417909383134479, 2.867993877991489);
  setServo(2.411688717189182, 2.877993877991489);
  setServo(2.40558960461331, 2.8879938779914887);
  setServo(2.3996109536019175, 2.8979938779914884);
  setServo(2.393751737824707, 2.9079938779914882);
  setServo(2.3880109935985643, 2.917993877991488);
  setServo(2.3823878172721606, 2.927993877991488);
  setServo(2.3768813628071164, 2.9379938779914876);
  setServo(2.3714908395416994, 2.9479938779914874);
  setServo(2.3662155101243356, 2.957993877991487);
  setServo(2.361054688605503, 2.967993877991487);
  setServo(2.356007738677685, 2.9779938779914867);
  setServo(2.3510740720539913, 2.9879938779914865);
  setServo(2.3462531469770083, 2.9979938779914863);
  setServo(2.3415444668502854, 3.007993877991486);
  setServo(2.3369475789855705, 3.017993877991486);
  setServo(2.3324620734595993, 3.0279938779914857);
  setServo(2.3280875820748275, 3.0379938779914855);
  setServo(2.323823777419267, 3.0479938779914852);
  setServo(2.319670372020787, 3.057993877991485);
  setServo(2.3156271175920637, 3.067993877991485);
  setServo(2.311693804362654, 3.0779938779914846);
  setServo(2.307870260495037, 3.0879938779914844);
  setServo(2.3041563515820616, 3.097993877991484);
  setServo(2.300551980223603, 3.107993877991484);
  setServo(2.297057085680106, 3.1179938779914838);
  setServo(2.29367164360218, 3.1279938779914835);
  setServo(2.290395665834148, 3.1379938779914833);
  setServo(2.2872292002916934, 3.147993877991483);
  setServo(2.284172330911467, 3.157993877991483);
  setServo(2.281225177674157, 3.1679938779914827);
  setServo(2.2783878967002855, 3.1779938779914825);
  setServo(2.2756606804183943, 3.1879938779914823);
  setServo(2.2730437578076454, 3.197993877991482);
  setServo(2.270537394714675, 3.207993877991482);
  setServo(2.268141894246795, 3.2179938779914816);
  setServo(2.2658575972428783, 3.2279938779914814);
  setServo(2.263684882823902, 3.237993877991481);
  setServo(2.261624169025665, 3.247993877991481);
  setServo(2.2596759135165323, 3.2579938779914808);
  setServo(2.2578406144031575, 3.2679938779914806);
  setServo(2.2561188111280086, 3.2779938779914803);
  setServo(2.2545110854627346, 3.28799387799148);
  setServo(2.2530180626020084, 3.29799387799148);
  setServo(2.251640412362907, 3.3079938779914797);
  setServo(2.2503788504956783, 3.3179938779914795);
  setServo(2.24923414011222, 3.3279938779914793);
  setServo(2.2482070932393827, 3.337993877991479);
  setServo(2.2472985725048855, 3.347993877991479);
  setServo(2.2465094929646328, 3.3579938779914786);
  setServo(2.2458408240810277, 3.3679938779914784);
  setServo(2.245293591862879, 3.377993877991478);
  setServo(2.2448688811787867, 3.387993877991478);
  setServo(2.2445678382569914, 3.397993877991478);
  setServo(2.244391673386195, 3.4079938779914776);
  setServo(2.244341663833298, 3.4179938779914774);
  setServo(2.2444191569959338, 3.427993877991477);
  setServo(2.2446255738094614, 3.437993877991477);
  setServo(2.244962412430345, 3.4479938779914767);
  setServo(2.2454312522203814, 3.4579938779914765);
  setServo(2.246033758058926, 3.4679938779914763);
  setServo(2.2467716850134924, 3.477993877991476);
  setServo(2.247646883402639, 3.487993877991476);
  setServo(2.248661304289151, 3.4979938779914757);
  setServo(2.249817005446061, 3.5079938779914754);
  setServo(2.2511161578434367, 3.5179938779914752);
  setServo(2.25256105270975, 3.527993877991475);
  setServo(2.2541541092286685, 3.537993877991475);
  setServo(2.255897882939948, 3.5479938779914746);
  setServo(2.257795074922328, 3.5579938779914744);
  setServo(2.25984854184684, 3.567993877991474);
  setServo(2.2620613070012716, 3.577993877991474);
  setServo(2.264436572400716, 3.5879938779914737);
  setServo(2.2669777321158144, 3.5979938779914735);
  setServo(2.2696883869697775, 3.6079938779914733);
  setServo(2.272572360778077, 3.617993877991473);
  setServo(2.275633718331739, 3.627993877991473);
  setServo(2.2788767853569563, 3.6379938779914727);
  setServo(2.282306170721722, 3.6479938779914725);
  setServo(2.285926791205247, 3.6579938779914722);
  setServo(2.2897438992000887, 3.667993877991472);
  setServo(2.293763113781964, 3.677993877991472);
  setServo(2.2979904556609267, 3.6879938779914716);
  setServo(2.302432386623106, 3.6979938779914714);
  setServo(2.307095854188962, 3.707993877991471);
  setServo(2.3119883423573127, 3.717993877991471);
  setServo(2.3171179294813733, 3.7279938779914708);
  setServo(2.322493354543091, 3.7379938779914705);
  setServo(2.328124093367221, 3.7479938779914703);
  setServo(2.334020446663315, 3.75799387799147);
  setServo(2.340193642223716, 3.76799387799147);
  setServo(2.3466559541685115, 3.7779938779914697);
  setServo(2.3534208428543586, 3.7879938779914695);
  setServo(2.360503120009227, 3.7979938779914693);
  setServo(2.367919144897347, 3.807993877991469);
  setServo(2.37568705896883, 3.817993877991469);
  setServo(2.3838270686651906, 3.8279938779914686);
  setServo(2.392361789066849, 3.8379938779914684);
  setServo(2.4013166652238174, 3.847993877991468);
  setServo(2.4107204938214473, 3.857993877991468);
  setServo(2.417889439579052, 3.865295867600535);
  setServo(2.427889439579052, 3.8750479836405853);
  setServo(2.4378894395790516, 3.8843276336079247);
  setServo(2.4478894395790514, 3.893166465017474);
  setServo(2.457889439579051, 3.9015923120956995);
  setServo(2.467889439579051, 3.9096298096396453);
  setServo(2.4778894395790507, 3.917300884965979);
  setServo(2.4878894395790505, 3.9246251563299905);
  setServo(2.4978894395790503, 3.931620258697008);
  setServo(2.50788943957905, 3.9383021124487243);
  setServo(2.51788943957905, 3.944685146801552);
  setServo(2.5278894395790497, 3.950782486942793);
  setServo(2.5378894395790494, 3.9566061118457494);
  setServo(2.5478894395790492, 3.9621669881980646);
  setServo(2.557889439579049, 3.967475184724796);
  setServo(2.567889439579049, 3.9725399703083735);
  setServo(2.5778894395790486, 3.977369898630345);
  setServo(2.5878894395790484, 3.9819728815336632);
  setServo(2.597889439579048, 3.9863562528919028);
  setServo(2.607889439579048, 3.990526824446413);
  setServo(2.6178894395790477, 3.9944909348133995);
  setServo(2.6278894395790475, 3.9982544926556525);
  setServo(2.6378894395790473, 4.001823014846517);
  setServo(2.647889439579047, 4.0052016603181855);
  setServo(2.657889439579047, 4.008395260175865);
  setServo(2.6678894395790467, 4.011408344568751);
  setServo(2.6778894395790465, 4.014245166733992);
  setServo(2.6878894395790462, 4.016909724567995);
  setServo(2.697889439579046, 4.019405780027878);
  setServo(2.707889439579046, 4.0217368766228105);
  setServo(2.7178894395790456, 4.023906355218944);
  setServo(2.7278894395790454, 4.025917368350992);
  setServo(2.737889439579045, 4.027772893207932);
  setServo(2.747889439579045, 4.029475743438322);
  setServo(2.7578894395790448, 4.031028579902037);
  setServo(2.7678894395790445, 4.032433920479372);
  setServo(2.7778894395790443, 4.033694149034707);
  setServo(2.787889439579044, 4.034811523620171);
  setServo(2.797889439579044, 4.035788183994567);
  setServo(2.8078894395790437, 4.036626158524054);
  setServo(2.8178894395790435, 4.03732737052337);
  setServo(2.8278894395790433, 4.0378936440898086);
  setServo(2.837889439579043, 4.038326709476317);
  setServo(2.847889439579043, 4.038628208044974);
  setServo(2.8578894395790426, 4.038799696837716);
  setServo(2.8678894395790424, 4.038842652797214);
  setServo(2.877889439579042, 4.038758476667391);
  setServo(2.887889439579042, 4.038548496599921);
  setServo(2.8978894395790418, 4.0382139714905065);
  setServo(2.9078894395790416, 4.037756094066204);
  setServo(2.9178894395790413, 4.037175993742975);
  setServo(2.927889439579041, 4.036474739270771);
  setServo(2.937889439579041, 4.035653341181693);
  setServo(2.9478894395790407, 4.034712754055368);
  setServo(2.9578894395790405, 4.033653878614124);
  setServo(2.9678894395790403, 4.032477563659594);
  setServo(2.97788943957904, 4.031184607860899);
  setServo(2.98788943957904, 4.029775761404071);
  setServo(2.9978894395790396, 4.028251727510854);
  setServo(3.0078894395790394, 4.026613163834796);
  setServo(3.017889439579039, 4.024860683741339);
  setServo(3.027889439579039, 4.02299485747821);
  setServo(3.037889439579039, 4.021016213241657);
  setServo(3.0478894395790386, 4.018925238143524);
  setServo(3.0578894395790384, 4.016722379083616);
  setServo(3.067889439579038, 4.014408043531413);
  setServo(3.077889439579038, 4.011982600220455);
  setServo(3.0878894395790377, 4.009446379758719);
  setServo(3.0978894395790375, 4.006799675157483);
  setServo(3.1078894395790373, 4.004042742280954);
  setServo(3.117889439579037, 4.001175800218794);
  setServo(3.127889439579037, 3.998199031582838);
  setServo(3.1378894395790367, 3.9951125827294156);
  setServo(3.1478894395790364, 3.99191656390832);
  setServo(3.1578894395790362, 3.988611049338294);
  setServo(3.167889439579036, 3.9851960772109627);
  setServo(3.177889439579036, 3.9816716496206226);
  setServo(3.1878894395790356, 3.9780377324222296);
  setServo(3.1978894395790354, 3.974294255014994);
  setServo(3.207889439579035, 3.9704411100515022);
  setServo(3.217889439579035, 3.9664781530708333);
  setServo(3.2278894395790347, 3.9624052020540006);
  setServo(3.2378894395790345, 3.9582220368995866);
  setServo(3.2478894395790343, 3.9539283988175806);
  setServo(3.257889439579034, 3.9495239896381134);
  setServo(3.267889439579034, 3.9450084710323603);
  setServo(3.2778894395790337, 3.940381463641823);
  setServo(3.2878894395790335, 3.9356425461117874);
  setServo(3.2978894395790332, 3.930791254024603);
  setServo(3.307889439579033, 3.925827078727458);
  setServo(3.317889439579033, 3.920749466049028);
  setServo(3.3278894395790326, 3.9155578148985715);
  setServo(3.3378894395790324, 3.9102514757404414);
  setServo(3.347889439579032, 3.904829748936172);
  setServo(3.357889439579032, 3.899291882945399);
  setServo(3.3678894395790318, 3.8936370723761455);
  setServo(3.3778894395790315, 3.8878644558736544);
  setServo(3.3878894395790313, 3.8819731138361564);
  setServo(3.397889439579031, 3.8759620659444263);
  setServo(3.407889439579031, 3.8698302684908104);
  setServo(3.4178894395790307, 3.863576611491586);
  setServo(3.4278894395790305, 3.857199915565045);
  setServo(3.4378894395790303, 3.8506989285554893);
  setServo(3.44788943957903, 3.8440723218813235);
  setServo(3.45788943957903, 3.8373186865828246);
  setServo(3.4678894395790296, 3.8304365290424216);
  setServo(3.4778894395790294, 3.8234242663472324);
  setServo(3.487889439579029, 3.8162802212599005);
  setServo(3.497889439579029, 3.809002616759911);
  setServo(3.5078894395790288, 3.8015895701127143);
  setServo(3.5178894395790286, 3.7940390864190245);
  setServo(3.5278894395790283, 3.786349051590339);
  setServo(3.537889439579028, 3.7785172246900856);
  setServo(3.547889439579028, 3.7705412295717244);
  setServo(3.5578894395790277, 3.762418545736075);
  setServo(3.5678894395790275, 3.7541464983195127);
  setServo(3.5778894395790273, 3.745722247112559);
  setServo(3.587889439579027, 3.7371427744939676);
  setServo(3.597889439579027, 3.728404872149);
  setServo(3.6078894395790266, 3.719505126421005);
  setServo(3.6178894395790264, 3.7104399021226655);
  setServo(3.627889439579026, 3.701205324606314);
  setServo(3.637889439579026, 3.691797259860967);
  setServo(3.647889439579026, 3.682211292365828);
  setServo(3.6578894395790256, 3.6724427003850106);
  setServo(3.665191429188092, 3.665191429188092);
  setServo(3.655191429188092, 3.655191429188092);
  setServo(3.6451914291880922, 3.6451914291880922);
  setServo(3.6351914291880925, 3.6351914291880925);
  setServo(3.6251914291880927, 3.6251914291880927);
  setServo(3.615191429188093, 3.615191429188093);
  setServo(3.605191429188093, 3.605191429188093);
  setServo(3.5951914291880933, 3.5951914291880933);
  setServo(3.5851914291880935, 3.5851914291880935);
  setServo(3.5751914291880937, 3.5751914291880937);
  setServo(3.565191429188094, 3.565191429188094);
  setServo(3.555191429188094, 3.555191429188094);
  setServo(3.5451914291880944, 3.5451914291880944);
  setServo(3.5351914291880946, 3.5351914291880946);
  setServo(3.525191429188095, 3.525191429188095);
  setServo(3.515191429188095, 3.515191429188095);
  setServo(3.5051914291880952, 3.5051914291880952);
  setServo(3.4951914291880954, 3.4951914291880954);
  setServo(3.4851914291880957, 3.4851914291880957);
  setServo(3.475191429188096, 3.475191429188096);
  setServo(3.465191429188096, 3.465191429188096);
  setServo(3.4551914291880963, 3.4551914291880963);
  setServo(3.4451914291880965, 3.4451914291880965);
  setServo(3.4351914291880967, 3.4351914291880967);
  setServo(3.425191429188097, 3.425191429188097);
  setServo(3.415191429188097, 3.415191429188097);
  setServo(3.4051914291880974, 3.4051914291880974);
  setServo(3.3951914291880976, 3.3951914291880976);
  setServo(3.385191429188098, 3.385191429188098);
  setServo(3.375191429188098, 3.375191429188098);
  setServo(3.365191429188098, 3.365191429188098);
  setServo(3.3551914291880984, 3.3551914291880984);
  setServo(3.3451914291880986, 3.3451914291880986);
  setServo(3.335191429188099, 3.335191429188099);
  setServo(3.325191429188099, 3.325191429188099);
  setServo(3.3151914291880993, 3.3151914291880993);
  setServo(3.3051914291880995, 3.3051914291880995);
  setServo(3.2951914291880997, 3.2951914291880997);
  setServo(3.2851914291881, 3.2851914291881);
  setServo(3.2751914291881, 3.2751914291881);
  setServo(3.2651914291881003, 3.2651914291881003);
  setServo(3.2551914291881006, 3.2551914291881006);
  setServo(3.2451914291881008, 3.2451914291881008);
  setServo(3.235191429188101, 3.235191429188101);
  setServo(3.225191429188101, 3.225191429188101);
  setServo(3.2151914291881014, 3.2151914291881014);
  setServo(3.2051914291881016, 3.2051914291881016);
  setServo(3.195191429188102, 3.195191429188102);
  setServo(3.185191429188102, 3.185191429188102);
  setServo(3.1751914291881023, 3.1751914291881023);
  setServo(3.1651914291881025, 3.1651914291881025);
  setServo(3.1551914291881027, 3.1551914291881027);
  setServo(3.145191429188103, 3.145191429188103);
  setServo(3.135191429188103, 3.135191429188103);
  setServo(3.1251914291881033, 3.1251914291881033);
  setServo(3.1151914291881035, 3.1151914291881035);
  setServo(3.1051914291881038, 3.1051914291881038);
  setServo(3.095191429188104, 3.095191429188104);
  setServo(3.085191429188104, 3.085191429188104);
  setServo(3.0751914291881044, 3.0751914291881044);
  setServo(3.0651914291881046, 3.0651914291881046);
  setServo(3.055191429188105, 3.055191429188105);
  setServo(3.045191429188105, 3.045191429188105);
  setServo(3.0351914291881052, 3.0351914291881052);
  setServo(3.0251914291881055, 3.0251914291881055);
  setServo(3.0151914291881057, 3.0151914291881057);
  setServo(3.005191429188106, 3.005191429188106);
  setServo(2.995191429188106, 2.995191429188106);
  setServo(2.9851914291881063, 2.9851914291881063);
  setServo(2.9751914291881065, 2.9751914291881065);
  setServo(2.9651914291881067, 2.9651914291881067);
  setServo(2.955191429188107, 2.955191429188107);
  setServo(2.945191429188107, 2.945191429188107);
  setServo(2.9351914291881074, 2.9351914291881074);
  setServo(2.9251914291881076, 2.9251914291881076);
  setServo(2.915191429188108, 2.915191429188108);
  setServo(2.905191429188108, 2.905191429188108);
  setServo(2.8951914291881082, 2.8951914291881082);
  setServo(2.8851914291881084, 2.8851914291881084);
  setServo(2.8751914291881087, 2.8751914291881087);
  setServo(2.865191429188109, 2.865191429188109);
  setServo(2.855191429188109, 2.855191429188109);
  setServo(2.8451914291881093, 2.8451914291881093);
  setServo(2.8351914291881095, 2.8351914291881095);
  setServo(2.8251914291881097, 2.8251914291881097);
  setServo(2.81519142918811, 2.81519142918811);
  setServo(2.80519142918811, 2.80519142918811);
  setServo(2.7951914291881104, 2.7951914291881104);
  setServo(2.7851914291881106, 2.7851914291881106);
  setServo(2.775191429188111, 2.775191429188111);
  setServo(2.765191429188111, 2.765191429188111);
  setServo(2.755191429188111, 2.755191429188111);
  setServo(2.7451914291881114, 2.7451914291881114);
  setServo(2.7351914291881116, 2.7351914291881116);
  setServo(2.725191429188112, 2.725191429188112);
  setServo(2.715191429188112, 2.715191429188112);
  setServo(2.7051914291881123, 2.7051914291881123);
  setServo(2.6951914291881125, 2.6951914291881125);
  setServo(2.6851914291881127, 2.6851914291881127);
  setServo(2.675191429188113, 2.675191429188113);
  setServo(2.665191429188113, 2.665191429188113);
  setServo(2.6551914291881134, 2.6551914291881134);
  setServo(2.6451914291881136, 2.6451914291881136);
  setServo(2.6351914291881138, 2.6351914291881138);
  setServo(2.625191429188114, 2.625191429188114);
}
